<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a5f1a">
    <title>AC Opening Drill</title>
    <link rel="manifest" href="ac-drill-manifest.json">
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: #1a5f1a;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .progress-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
        }

        main {
            flex: 1;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .card {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 16px;
            border-left: 4px solid #666;
        }

        .card-blue {
            border-left-color: #2196F3;
            background: linear-gradient(135deg, #1a2a3a 0%, #2a2a2a 100%);
        }

        .card-red {
            border-left-color: #f44336;
            background: linear-gradient(135deg, #3a1a1a 0%, #2a2a2a 100%);
        }

        .card-black {
            border-left-color: #888;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
        }

        .turn-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            margin-bottom: 4px;
        }

        .turn-label.blue { color: #64b5f6; }
        .turn-label.red { color: #ef9a9a; }
        .turn-label.black { color: #bbb; }

        .opening-name {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .position {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 8px;
        }

        .description {
            font-size: 14px;
            color: #ccc;
            line-height: 1.4;
        }

        .tag {
            display: inline-block;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 4px;
            margin-top: 8px;
        }

        .tag-aggressive { background: #c62828; }
        .tag-defensive { background: #1565c0; }
        .tag-neutral { background: #555; }

        .black-options {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #444;
        }

        .black-options h4 {
            margin: 0 0 8px 0;
            font-size: 13px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .black-options ul {
            margin: 0;
            padding: 0 0 0 16px;
            font-size: 14px;
            color: #ccc;
        }

        .black-options li {
            margin: 6px 0;
            line-height: 1.4;
        }

        .buttons {
            display: flex;
            gap: 12px;
            margin-top: auto;
            padding-top: 16px;
        }

        button {
            flex: 1;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.1s;
        }

        button:active {
            transform: scale(0.98);
            opacity: 0.9;
        }

        .btn-primary {
            background: #1a5f1a;
            color: white;
        }

        .btn-secondary {
            background: #444;
            color: white;
        }

        .btn-success {
            background: #2e7d32;
            color: white;
        }

        .state-start {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            text-align: center;
            gap: 20px;
        }

        .state-start h2 {
            font-size: 28px;
            margin: 0;
        }

        .state-start p {
            color: #888;
            margin: 0;
            font-size: 16px;
        }

        .start-btn {
            padding: 20px 60px;
            font-size: 20px;
            background: #1a5f1a;
            color: white;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            margin-top: 20px;
        }

        /* History Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            padding: 20px;
            overflow-y: auto;
        }

        .modal-overlay.active {
            display: block;
        }

        .modal {
            background: #2a2a2a;
            border-radius: 16px;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }

        .modal h2 {
            margin: 0 0 16px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            color: #888;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        .history-item {
            background: #1a1a1a;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .history-item .combo {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .history-item .meta {
            font-size: 12px;
            color: #888;
        }

        .history-empty {
            text-align: center;
            color: #666;
            padding: 40px;
        }

        .clear-btn {
            width: 100%;
            margin-top: 16px;
            padding: 12px;
            background: #c62828;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        nav {
            display: flex;
            background: #2a2a2a;
            border-top: 1px solid #333;
        }

        nav button {
            flex: 1;
            background: none;
            border: none;
            color: #888;
            padding: 12px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        nav button.active {
            color: #1a5f1a;
        }

        nav button svg {
            width: 24px;
            height: 24px;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    <header>
        <h1>AC Opening Drill</h1>
        <div style="display: flex; align-items: center; gap: 12px;">
            <div class="progress-badge" id="progress-badge">0/14</div>
            <button onclick="showHelp()" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer; padding: 4px;">?</button>
        </div>
    </header>

    <main id="main-content">
        <!-- Start State -->
        <div class="state-start" id="state-start">
            <h2>Practice AC Openings</h2>
            <p>Random drills for Turns 1-3</p>
            <button class="start-btn" onclick="startDrill()">Start Drill</button>
        </div>

        <!-- Drill State -->
        <div id="state-drill" class="hidden">
            <div class="card card-blue" id="card-blue">
                <div class="turn-label blue">Turn 1: Blue</div>
                <div class="opening-name" id="blue-name"></div>
                <div class="position" id="blue-position"></div>
                <div class="description" id="blue-description"></div>
            </div>

            <div class="card card-red" id="card-red">
                <div class="turn-label red">Turn 2: Red Response</div>
                <div class="opening-name" id="red-name"></div>
                <div class="position" id="red-position"></div>
                <div class="description" id="red-description"></div>
                <span class="tag" id="red-tag"></span>

                <div class="black-options">
                    <h4>Turn 3: Black Options</h4>
                    <ul id="black-options"></ul>
                </div>
            </div>

            <div class="buttons">
                <button class="btn-secondary" onclick="startDrill()">Next Drill</button>
                <button class="btn-success" onclick="markPracticed()">Mark Practiced</button>
            </div>
        </div>
    </main>

    <!-- Help Modal -->
    <div class="modal-overlay" id="help-modal">
        <div class="modal">
            <h2>
                How to Use
                <button class="modal-close" onclick="closeHelp()">&times;</button>
            </h2>
            <div style="color: #ccc; line-height: 1.6;">
                <p><strong>Practice random AC opening combinations:</strong></p>
                <ol style="padding-left: 20px; margin: 12px 0;">
                    <li><strong>Start Drill</strong> - Get a random Blue opening + Red response</li>
                    <li><strong>Set up the balls</strong> on court as shown</li>
                    <li><strong>Review Black options</strong> - decide your Turn 3 play</li>
                    <li><strong>Mark Practiced</strong> - records this combination</li>
                    <li><strong>Next Drill</strong> - get another random combination</li>
                </ol>
                <p style="margin-top: 16px;"><strong>Progress:</strong> The badge shows how many of the 14 combinations you've practiced. Unpracticed combos are prioritized.</p>
                <p style="margin-top: 12px;"><strong>Install:</strong> Tap browser menu → "Add to Home Screen" to use like an app.</p>
                <p style="margin-top: 16px; font-size: 12px; color: #888;">Strategy details: <a href="ac-strategy.html" style="color: #64b5f6;">AC Strategy Page</a></p>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal-overlay" id="history-modal">
        <div class="modal">
            <h2>
                Practice History
                <button class="modal-close" onclick="closeHistory()">&times;</button>
            </h2>
            <div id="history-list"></div>
            <button class="clear-btn" onclick="clearHistory()">Clear All History</button>
        </div>
    </div>

    <nav>
        <button class="active" onclick="showDrill()">
            <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
            Drill
        </button>
        <button onclick="showHistory()">
            <svg fill="currentColor" viewBox="0 0 24 24"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg>
            History
        </button>
    </nav>

    <script>
        // Opening data structure
        const openings = [
            {
                id: 'eb',
                name: 'East Boundary',
                position: 'H4-H5 level, on boundary',
                description: 'Defensive, non-threatening. Lets opponent dictate game style.',
                responses: [
                    {
                        id: 'eb-tice',
                        name: 'Standard Tice',
                        position: 'WB 8-13yd N of C1',
                        description: 'Distance should match opponent\'s critical distance (50% hit rate).',
                        style: 'neutral',
                        blackOptions: [
                            'Shoot Blue from A baulk (miss = free shot for Yellow)',
                            'Join with Red (C3 toward C4) - avoids double targets',
                            'Shoot Red directly - hit = dream leave (aggressive)'
                        ]
                    },
                    {
                        id: 'eb-c2',
                        name: 'C2 Ball',
                        position: '6" S of C2',
                        description: 'Defensive positioning preventing double targets if Black misses.',
                        style: 'defensive',
                        blackOptions: [
                            'Shoot Partner from A baulk (leaves double target)',
                            'Shoot Partner from C3 (avoids doubles)',
                            'Join near Red (3-4ft S) - no double, good break if Yellow misses'
                        ]
                    },
                    {
                        id: 'eb-duffer',
                        name: 'Duffer Tice',
                        position: '2ft N of penult, few inches E',
                        description: 'Aggressive: encourages gentle miss toward A baulk.',
                        style: 'aggressive',
                        blackOptions: [
                            'Shoot Red - reasonable break if hit (common)',
                            'Shoot from C3 - miss toward WB avoids Yellow break (defensive)',
                            'Shoot Partner from A baulk - big croquet to H2'
                        ]
                    },
                    {
                        id: 'eb-c4',
                        name: 'C4 Ball',
                        position: '6" N of C4',
                        description: 'Aggressive, NZ-style opening signaling fourth-turn break intent.',
                        style: 'aggressive',
                        blackOptions: [
                            'Shoot Partner - hit = dream leave, miss = 13yd Yellow shot',
                            'Shoot C4 from A baulk - hit = dream leave, miss = tricky double',
                            'Join N of C4 - no double, 13yd Yellow shot',
                            'Black to C2 - neutralize; Yellow miss = 9yd response (defensive)'
                        ]
                    },
                    {
                        id: 'eb-shoot',
                        name: 'Shoot Blue',
                        position: 'Direct attack',
                        description: 'Risk: misses may leave triple targets for Yellow.',
                        style: 'aggressive',
                        blackOptions: [
                            'If Red hits: Red has break',
                            'If Red misses: may leave triple target for Yellow'
                        ]
                    }
                ]
            },
            {
                id: 'ileb',
                name: 'In-Lawn East Boundary',
                position: '1yd infield from EB, H4-H5',
                description: 'Allows Black to play behind Blue on turn 3, discourages aggressive WB responses.',
                responses: [
                    {
                        id: 'ileb-tice',
                        name: 'Standard Tice',
                        position: 'WB 8-13yd N of C1',
                        description: 'Black can play behind Blue.',
                        style: 'neutral',
                        blackOptions: [
                            'Play behind Blue (Black joins Blue)',
                            'Shoot Tice - hit = break',
                            'Discourages aggressive WB responses'
                        ]
                    },
                    {
                        id: 'ileb-c2',
                        name: 'C2 Ball',
                        position: '6" S of C2',
                        description: 'Defensive counter.',
                        style: 'defensive',
                        blackOptions: [
                            'Shoot Partner from A baulk',
                            'Join near Red (3-4ft S)'
                        ]
                    }
                ]
            },
            {
                id: 'super',
                name: 'Supershot',
                position: 'Center court, 2yd W of centerline',
                description: 'Most aggressive sensible option. Signals "no grey area."',
                responses: [
                    {
                        id: 'super-c2',
                        name: 'C2 Response',
                        position: '6" S of C2',
                        description: 'Requires 13-yard Black shot; miss leaves double target for Yellow.',
                        style: 'defensive',
                        blackOptions: [
                            '13yd shot required for Black',
                            'Miss leaves double target for Yellow'
                        ]
                    },
                    {
                        id: 'super-c4',
                        name: 'C4 Response',
                        position: '6" N of C4',
                        description: 'Use when peg-high or when H4 blocks croquet angles.',
                        style: 'aggressive',
                        blackOptions: [
                            'Use when peg-high or H4 blocks croquet angles',
                            'Mirror of C2 response'
                        ]
                    },
                    {
                        id: 'super-max',
                        name: 'Max Distance',
                        position: 'EB near peg level',
                        description: 'Counter against elite players - longest possible shot for Black.',
                        style: 'defensive',
                        blackOptions: [
                            'Longest possible shot for Black',
                            'Use against elite shooters'
                        ]
                    },
                    {
                        id: 'super-lag',
                        name: 'Supershot Lag',
                        position: '3-4yd E, 1-2yd N of Blue',
                        description: 'Nullifies shooting strength.',
                        style: 'neutral',
                        blackOptions: [
                            'Nullifies shooting strength',
                            'Creates close engagement'
                        ]
                    },
                    {
                        id: 'super-roquet',
                        name: 'Roquet Supershot',
                        position: 'Hit it!',
                        description: 'Ultimate nullification. Croquet options available.',
                        style: 'aggressive',
                        blackOptions: [
                            'Croquet Blue to C2, or NW of H2, or wire at peg',
                            'Ultimate nullification if hit'
                        ]
                    }
                ]
            },
            {
                id: 'anti',
                name: 'Anti-Duffer',
                position: 'H6-peg, 1-2yd W of E boundary',
                description: 'Discourages "duffer tice" responses. Strong Turn 3 break potential.',
                responses: [
                    {
                        id: 'anti-duffer',
                        name: 'Duffer Tice',
                        position: '2ft N of penult',
                        description: 'Anti-Duffer discourages this response.',
                        style: 'aggressive',
                        blackOptions: [
                            'Shoot Red - break if hit',
                            'Anti-Duffer discourages this response',
                            'Black has strong Turn 3 break potential'
                        ]
                    },
                    {
                        id: 'anti-tice',
                        name: 'Standard Tice',
                        position: 'WB 8-13yd N of C1',
                        description: 'Neutral response.',
                        style: 'neutral',
                        blackOptions: [
                            'Shoot Tice - hit = dream leave',
                            'Join with Blue'
                        ]
                    }
                ]
            }
        ];

        // Build flat list of all combinations
        let allCombinations = [];
        openings.forEach(opening => {
            opening.responses.forEach(response => {
                allCombinations.push({
                    id: response.id,
                    opening: opening,
                    response: response
                });
            });
        });

        // State
        let currentCombo = null;
        let history = JSON.parse(localStorage.getItem('ac-drill-history') || '[]');

        // Update progress badge
        function updateProgress() {
            const practiced = new Set(history.map(h => h.id));
            document.getElementById('progress-badge').textContent =
                `${practiced.size}/${allCombinations.length}`;
        }

        // Start a new drill
        function startDrill() {
            // Prioritize unpracticed combinations
            const practiced = new Set(history.map(h => h.id));
            const unpracticed = allCombinations.filter(c => !practiced.has(c.id));

            let pool = unpracticed.length > 0 ? unpracticed : allCombinations;
            currentCombo = pool[Math.floor(Math.random() * pool.length)];

            // Update UI
            document.getElementById('state-start').classList.add('hidden');
            document.getElementById('state-drill').classList.remove('hidden');

            const { opening, response } = currentCombo;

            document.getElementById('blue-name').textContent = opening.name;
            document.getElementById('blue-position').textContent = opening.position;
            document.getElementById('blue-description').textContent = opening.description;

            document.getElementById('red-name').textContent = response.name;
            document.getElementById('red-position').textContent = response.position;
            document.getElementById('red-description').textContent = response.description;

            const tag = document.getElementById('red-tag');
            tag.textContent = response.style;
            tag.className = 'tag tag-' + response.style;

            const blackList = document.getElementById('black-options');
            blackList.innerHTML = response.blackOptions.map(opt => `<li>${opt}</li>`).join('');
        }

        // Mark current combo as practiced
        function markPracticed() {
            if (!currentCombo) return;

            history.push({
                id: currentCombo.id,
                opening: currentCombo.opening.name,
                response: currentCombo.response.name,
                timestamp: Date.now()
            });

            localStorage.setItem('ac-drill-history', JSON.stringify(history));
            updateProgress();

            // Visual feedback
            const btn = event.target;
            btn.textContent = 'Recorded!';
            btn.style.background = '#1565c0';
            setTimeout(() => {
                btn.textContent = 'Mark Practiced';
                btn.style.background = '';
            }, 1000);
        }

        // Show history modal
        function showHistory() {
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            event.target.closest('button').classList.add('active');

            const list = document.getElementById('history-list');

            if (history.length === 0) {
                list.innerHTML = '<div class="history-empty">No practice sessions recorded yet.</div>';
            } else {
                // Group by combination and count
                const counts = {};
                history.forEach(h => {
                    const key = h.id;
                    if (!counts[key]) {
                        counts[key] = { ...h, count: 0, lastTime: 0 };
                    }
                    counts[key].count++;
                    counts[key].lastTime = Math.max(counts[key].lastTime, h.timestamp);
                });

                const sorted = Object.values(counts).sort((a, b) => b.lastTime - a.lastTime);

                list.innerHTML = sorted.map(h => `
                    <div class="history-item">
                        <div class="combo">${h.opening} → ${h.response}</div>
                        <div class="meta">Practiced ${h.count}x · Last: ${formatTime(h.lastTime)}</div>
                    </div>
                `).join('');
            }

            document.getElementById('history-modal').classList.add('active');
        }

        function formatTime(ts) {
            const d = new Date(ts);
            const now = new Date();
            if (d.toDateString() === now.toDateString()) {
                return 'Today ' + d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            }
            return d.toLocaleDateString();
        }

        function closeHistory() {
            document.getElementById('history-modal').classList.remove('active');
            showDrill();
        }

        function showDrill() {
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.querySelector('nav button:first-child').classList.add('active');
            document.getElementById('history-modal').classList.remove('active');
        }

        function clearHistory() {
            if (confirm('Clear all practice history?')) {
                history = [];
                localStorage.removeItem('ac-drill-history');
                updateProgress();
                closeHistory();
            }
        }

        // Help modal
        function showHelp() {
            document.getElementById('help-modal').classList.add('active');
        }

        function closeHelp() {
            document.getElementById('help-modal').classList.remove('active');
        }

        // Initialize
        updateProgress();
    </script>
</body>
</html>
